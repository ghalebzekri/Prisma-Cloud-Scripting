policyUpi,policyId,policyType,cloudType,severity,name,description,searchModel.query
PC-AWS-DAX-1232,e8980325-125e-4bcd-a0c8-68838ddab811,config,aws,informational,AWS DAX cluster not configured with encryption at rest,"This policy identifies the AWS DAX cluster where encryption at rest is disabled.  AWS DAX cluster encryption at rest provides an additional layer of data protection, helping secure your data from unauthorized access to underlying storage. Without encryption, anyone with access to the storage media could potentially intercept and view the data.  It is recommended to enable encryption at rest for the AWS DAX cluster.","config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-dax-cluster' AND json.rule = Status equals ""available"" and SSEDescription.Status equals ""DISABLED"""
PC-AWS-DYN-365,e1322a56-1172-4034-a793-300c062b66d2,config,aws,informational,AWS DynamoDB encrypted using AWS owned CMK instead of AWS managed CMK,"This policy identifies the DynamoDB tables that use AWS owned CMK (default ) instead of AWS managed CMK (KMS ) to encrypt data. AWS managed CMK provide additional features such as the ability to view the CMK and key policy, and audit the encryption and decryption of DynamoDB tables.",config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-dynamodb-describe-table' AND json.rule =  'ssedescription does not exist or (ssedescription exists and ssedescription.ssetype == AES256)'
PC-AWS-S3-30,4daa435b-fa46-457a-9359-6a4b4a43a442,config,aws,informational,AWS Access logging not enabled on S3 buckets,Checks for S3 buckets without access logging turned on. Access logging allows customers to view complete audit trail on sensitive workloads such as S3 buckets. It is recommended that Access logging is turned on for all S3 buckets to meet audit & compliance requirement,config from cloud.resource where cloud.type = 'aws' AND api.name='aws-s3api-get-bucket-acl' AND json.rule='loggingConfiguration.targetBucket equals null or loggingConfiguration.targetPrefix equals null'
PC-AWS-DOC-914,95cc1059-dc20-4b91-9f05-63af346947b5,config,aws,informational,AWS DocumentDB cluster deletion protection is disabled,This policy identifies AWS DocumentDB clusters for which deletion protection is disabled. Enabling deletion protection for DocumentDB clusters prevents irreversible data loss resulting from accidental or malicious operations.,config from cloud.resource where cloud.type = 'aws' AND api.name= 'aws-docdb-db-cluster' AND json.rule = Status contains available and DeletionProtection is false
PC-AWS-ACM-169,01740791-ebd5-417a-bbfe-e1fdfc322dcc,config,aws,informational,AWS Certificate Manager (ACM) contains certificate pending validation,"This policy identifies invalid certificates which are in AWS Certificate Manager. When your Amazon ACM certificates are not validated within 72 hours after the request is made, those certificates become invalid and you will have to request new certificates, which could cause interruption to your applications or services. Though AWS Certificate Manager automatically renews certificates issued by the service that is used with other AWS resources. However, the ACM service does not automatically renew certificates that are not currently in use or not associated anymore with other AWS resources. So the renewal process including validation must be done manually before these certificates become invalid.",config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-acm-describe-certificate' AND json.rule =  'status contains PENDING_VALIDATION'
PC-AWS-DMS-638,e1539f4f-7c9b-47bb-b3d5-9660f4ed0cda,config,aws,low,AWS Database Migration Service (DMS) has expired certificates,"This policy identifies expired certificates that are in AWS Database Migration Service (DMS). AWS Database Migration Service (DMS) Certificate service is the preferred tool to provision, manage, and deploy your DMS endpoint certificates. As a best practice, it is recommended to delete expired certificates.  For more details: https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Security.html#CHAP_Security.SSL.ManagingCerts",config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-dms-certificate' AND json.rule = '_DateTime.ageInDays(validToDate) > -1'
PC-AWS-IAM-6,88db4b66-4dec-48c0-9013-c7871d61b1c8,config,aws,high,AWS Access key enabled on root account,"This policy identifies root accounts for which access keys are enabled. Access keys are used to sign API requests to AWS. Root accounts have complete access to all your AWS services. If the access key for a root account is compromised, an unauthorized users will have complete access to your AWS account.",config from cloud.resource where cloud.type = 'aws' and api.name='aws-iam-get-account-summary' AND json.rule='not AccountAccessKeysPresent equals 0'
PC-AWS-CFG-296,75a95357-3a98-41b9-9367-5d00fb1ab5f1,config,aws,informational,AWS Config fails to deliver log files,"This policy identifies AWS Configs which are failing to deliver its log files to the specified S3 bucket. It happens when it doesn't have sufficient permissions to complete the operation. To deliver information to S3 bucket, AWS Config needs to assume an IAM role that manages the permissions required to access the designated S3 bucket.",config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-configservice-describe-configuration-recorders' AND json.rule = 'status.recording is true and status.lastStatus contains FAILURE'
PC-AWS-ASG-1053,897624ae-ff31-4270-bc71-1c8a36d84427,config,aws,medium,AWS Auto Scaling group launch configuration configured with Instance Metadata Service hop count greater than 1,"This policy identifies the autoscaling group launch configuration where the Instance Metadata Service network hops count is set to greater than 1. A launch configuration is an instance configuration template that an Auto Scaling group uses to launch EC2 instances. With the metadata response hop limit count for the IMDS greater than 1, the PUT response that contains the secret token can travel outside the EC2 instance. Only metadata with a limited hop count for all your EC2 instances is recommended.","config from cloud.resource where api.name = 'aws-ec2-autoscaling-launch-configuration' AND json.rule = metadataOptions.httpEndpoint exists and metadataOptions.httpEndpoint equals ""enabled"" and metadataOptions.httpPutResponseHopLimit greater than 1 as X; config from cloud.resource where api.name = 'aws-describe-auto-scaling-groups' as Y; filter ' $.X.launchConfigurationName equal ignore case $.Y.launchConfigurationName'; show X;"
PC-AWS-ACM-166,d1fae43a-5bb6-429a-945e-fec5e8d9c662,config,aws,low,AWS Certificate Manager (ACM) has expired certificates,"This policy identifies expired certificates which are in AWS Certificate Manager. AWS Certificate Manager (ACM) is the preferred tool to provision, manage, and deploy your server certificates. With ACM you can request a certificate or deploy an existing ACM or external certificate to AWS resources. This policy generates alerts if there are any expired ACM managed certificates. As a best practice, it is recommended to delete expired certificates.",config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-acm-describe-certificate' AND json.rule = '(_DateTime.ageInDays($.notAfter) > -1) and status equals EXPIRED'
PC-AWS-DMS-558,447fc9ef-a871-4e4b-b34c-46d4aad81f51,config,aws,low,AWS Database Migration Service endpoint do not have SSL configured,This policy identifies Database Migration Service (DMS) endpoints that are not configured with SSL to encrypt connections for source and target endpoints. It is recommended to use SSL connection for source and target endpoints; enforcing SSL connections help protect against 'man in the middle' attacks by encrypting the data stream between endpoint connections.  NOTE: Not all databases use SSL in the same way. An Amazon Redshift endpoint already uses an SSL connection and does not require an SSL connection set up by AWS DMS. So there are some exlcusions included in policy RQL to report only those endpoints which can be configured using DMS SSL feature.   For more details: https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Security.html#CHAP_Security.SSL,"config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-dms-endpoint' AND json.rule = status equals active and (endpointType equals SOURCE and sslMode equals none and engineName is not member of (""s3"", ""azuredb"")) or (endpointType equals TARGET and sslMode equals none and engineName is not member of (""dynamodb"", ""kinesis"", ""neptune"", ""redshift"", ""s3"", ""elasticsearch"", ""kafka""))"
PC-AWS-CWT-1235,5de329bf-6ea4-4bff-8e55-fb9e00adae7d,config,aws,informational,AWS CloudWatch log groups retention set to less than 365 days,"This policy identifies the AWS CloudWatch LogGroups having a retention period set to less than 365 days.   CloudWatch Logs centralize and store logs from AWS services and systems. 1-year retention of the logs aids in compliance with log retention standards. Shorter retention periods can lead to the loss of historical logs needed for audits, forensic analysis, and compliance, increasing the risk of undetected issues or non-compliance.  It is recommended that AWS CloudWatch log group retention be set to at least 365 days to meet compliance needs and support audits, investigations, and analysis.",config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-cloudwatch-log-group' AND json.rule = retentionInDays exists and retentionInDays less than 365
PC-AWS-API-1262,b5d59925-89c7-41b7-8c90-452bd429bb5f,config,aws,informational,AWS API Gateway REST API execution logging disabled,"This policy identifies AWS API Gateway REST API's that have disabled execution logging in their stages.  AWS API Gateway REST API is a service for creating and managing RESTful APIs integrated with backend services like Lambda and HTTP endpoints. Execution logs log all the API activity logs to CloudWatch, which helps in incident response, security and compliance, troubleshooting, and monitoring.  It is recommended to enable logging on the API Gateway REST API to track API activity.",config from cloud.resource where api.name = 'aws-apigateway-get-stages' AND json.rule = methodSettings.[*].loggingLevel does not exist or methodSettings.[*].loggingLevel equal ignore case off as X; config from cloud.resource where api.name = 'aws-apigateway-get-rest-apis' as Y; filter ' $.X.restApi equal ignore case $.Y.id '; show Y;
PC-AWS-VPC-22,2378dbf4-b104-4bda-9b05-7417affbba3f,config,aws,low,AWS Default Security Group does not restrict all traffic,"This policy identifies the default security groups which does not restrict inbound and outbound traffic. A VPC comes with a default security group whose initial configuration denies all inbound traffic and allow all outbound traffic. If you do not specify a security group when you launch an instance, the instance is automatically assigned to this default security group. As a result, the instance may accidentally send outbound traffic. It is recommended that to remove any inbound and outbound rules in the default security group and not to attach the default security group to any resources.",config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-ec2-describe-security-groups' AND json.rule = '((groupName == default) and (ipPermissions[*] is not empty or ipPermissionsEgress[*] is not empty))'
PC-AWS-ASY-835,efecd50f-5a1f-4d6d-b862-8e760b9612e4,config,aws,medium,AWS AppSync attached WAFv2 WebACL is not configured with AMR for Log4j Vulnerability,"This policy identifies AppSync attached with WAFv2 WebACL which is not configured with AWS Managed Rules (AMR) for Log4j Vulnerability. As per the guidelines given by AWS, AppSync attached with WAFv2 WebACL should be configured with AWS Managed Rules (AMR) AWSManagedRulesKnownBadInputsRuleSet and AWSManagedRulesAnonymousIpList to protect from Log4j Vulnerability (CVE-2021-44228).  For more information please refer below URL, https://aws.amazon.com/security/security-bulletins/AWS-2021-006/",config from cloud.resource where api.name = 'aws-appsync-graphql-api' AND json.rule = wafWebAclArn is not empty as X; config from cloud.resource where api.name = 'aws-waf-v2-web-acl-resource' AND json.rule = (webACL.postProcessFirewallManagerRuleGroups.firewallManagerStatement.name does not contain AWSManagedRulesAnonymousIpList or webACL.postProcessFirewallManagerRuleGroups.firewallManagerStatement.name does not contain AWSManagedRulesKnownBadInputsRuleSet) and NOT ( webACL.rules[*].statement.managedRuleGroupStatement.name contains AWSManagedRulesAnonymousIpList and webACL.rules[*].statement.managedRuleGroupStatement.name contains AWSManagedRulesKnownBadInputsRuleSet ) as Y; filter '$.Y.webACL.arn equals $.X.wafWebAclArn'; show X;
PC-AWS-ASY-1151,53f3d4fd-c735-4eae-bdfa-cedec9126d68,config,aws,informational,AWS AppSync has field-level logging disabled,"This policy identifies an AWS AppSync GraphQL API not configured with field-level logging with either 'ERROR' or 'ALL'.  AWS AppSync is a managed GraphQL service that simplifies the development of scalable APIs. Field-level logging in AWS AppSync lets you capture detailed logs for specific fields in your GraphQL API. Without enabling field-level logging, the security monitoring and debugging capabilities may be compromised, increasing the risk of undetected threats and vulnerabilities.  It is recommended to enable field-level logging to ensure granular visibility into API requests, aiding in security, and compliance with regulatory requirements.","config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-appsync-graphql-api' AND json.rule = logConfig.fieldLogLevel is not member of ('ERROR','ALL')"
PC-AWS-EC2-31,7c714cb4-3d47-4c32-98d4-c13f92ce4ec5,config,aws,medium,AWS EBS snapshots are accessible to public,"This policy identifies EC2 EBS snapshots which are accessible to public. Amazon Elastic Block Store (Amazon EBS) provides persistent block storage volumes for use with Amazon EC2 instances in the AWS Cloud. If EBS snapshots are inadvertently shared to public, any unauthorized user with AWS console access can gain access to the snapshots and gain access to sensitive data.",config from cloud.resource where cloud.type = 'aws' and api.name='aws-ec2-describe-snapshots' AND json.rule='createVolumePermissions[*].group contains all'
PC-AWS-DMS-1155,de8ad979-6aa5-460e-b630-c7c79a8a3765,config,aws,low,AWS DMS replication instance automatic version upgrade disabled,"This policy identifies the AWS DMS(Database Migration Service) replication instances that do not have auto minor version upgrade feature enabled  A replication instance in DMS is a compute resource used to replicate data between a source and target database during the migration or ongoing replication process. Failure to enable automatic minor upgrades can leave your database instances vulnerable to security risks stemming from outdated software.  It is recommended to enable automatic minor version upgrades on DMS replication instances to receive timely patches and updates, reduce the risk of security vulnerabilities and improve overall performance and stability.","config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-dms-replication-instance' AND json.rule = replicationInstanceStatus equals ""available"" and autoMinorVersionUpgrade is false"
,866ca1d4-40cb-4626-afa0-5a438a92019a,iam,aws,high,AWS Compute Instance (EC2/Lambda) Assigned Lambda Creation Permissions Which Could Lead to Privilege Escalation,"An adversary able to create a Lambda Function with any role and give themselves the permissions to invoke it would be able to escalate their permissions by attaching a privileged role to the function while defining the Lambda's actions. As such, they would obtain the ability to perform actions using the permissions of the attached role, allowing further enumeration and exploitation of the environment.","config from iam where dest.cloud.type = 'AWS' AND action.name CONTAINS ALL ('iam:PassRole', 'lambda:CreateFunction', 'lambda:AddPermission') AND source.cloud.resource.type IN ('instance', 'function')"
PC-AWS-ATN-1130,5405e934-1c52-450a-84d4-0b84c5eb2fa8,config,aws,low,AWS Athena Workgroup data encryption at rest not configured,"This policy identifies AWS Athena workgroups not configured with data encryption at rest.  AWS Athena workgroup enables you to isolate queries for you or your group of users from other queries in the same account, to set the query results location and the encryption configuration. By default, Athena workgroup query run results are not encrypted at rest and client side settings can override the workgroup settings. Encrypting workgroups and preventing overrides from the client side helps in protecting the integrity and confidentiality of the data stored on Athena.  It is recommended to set encryption at rest and enable 'override client-side settings' to mitigate the risk of unauthorized access and potential data breaches.",config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-athena-workgroup' AND json.rule = WorkGroup.State equal ignore case enabled and (WorkGroup.Configuration.ResultConfiguration.EncryptionConfiguration does not exist or (WorkGroup.Configuration.EngineVersion.EffectiveEngineVersion contains Athena and WorkGroup.Configuration.EnforceWorkGroupConfiguration is false))
PC-AWS-API-833,8d65d3b7-75f2-4628-b07b-ab574041dbdf,config,aws,medium,AWS API Gateway Rest API attached WAFv2 WebACL is not configured with AMR for Log4j Vulnerability,"This policy identifies AWS API Gateway Rest API attached with WAFv2 WebACL which are not configured with AWS Managed Rules (AMR) for Log4j Vulnerability. As per the guidelines given by AWS, API Gateway Rest API attached with WAFv2 WebACL should be configured with AWS Managed Rules (AMR) AWSManagedRulesKnownBadInputsRuleSet and AWSManagedRulesAnonymousIpList to protect from Log4j Vulnerability (CVE-2021-44228).  For more information please refer below URL, https://aws.amazon.com/security/security-bulletins/AWS-2021-006/",config from cloud.resource where api.name = 'aws-apigateway-get-stages' AND json.rule = webAclArn is not empty as X; config from cloud.resource where api.name = 'aws-waf-v2-web-acl-resource' AND json.rule = (webACL.postProcessFirewallManagerRuleGroups.firewallManagerStatement.name does not contain AWSManagedRulesAnonymousIpList or webACL.postProcessFirewallManagerRuleGroups.firewallManagerStatement.name does not contain AWSManagedRulesKnownBadInputsRuleSet) and NOT ( webACL.rules[*].statement.managedRuleGroupStatement.name contains AWSManagedRulesAnonymousIpList and webACL.rules[*].statement.managedRuleGroupStatement.name contains AWSManagedRulesKnownBadInputsRuleSet ) as Y; filter '$.Y.webACL.arn equals $.X.webAclArn'; show X;
PC-AWS-CT-5,c2b84f89-7ec8-473e-a6af-404feeeb96c5,config,aws,informational,AWS CloudTrail logs are not encrypted using Customer Master Keys (CMKs),"Checks to ensure that CloudTrail logs are encrypted. AWS CloudTrail is a service that enables governance, compliance, operational & risk auditing of the AWS account. It is a compliance and security best practice to encrypt the CloudTrail data since it may contain sensitive information. ",config from cloud.resource where api.name='aws-cloudtrail-describe-trails' AND cloud.type = 'aws' AND json.rule = 'kmsKeyId does not exist'
PC-AWS-DMS-1131,a1497898-ea75-4d3b-b806-b9cae5442771,config,aws,low,AWS DMS replication instance is publicly accessible,"This policy identifies AWS DMS (Database Migration Service) replication instances with public accessibility enabled.  A DMS replication instance is used to connect and read the source data and prepare it for consumption by the target data store. When AWS DMS replication instances are publicly accessible, it increases the risk of unauthorized access, data breaches, and potentially malicious activities.  It is recommended to disable the public accessibility of DMS replication instances to decrease the attack surface.","config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-dms-replication-instance' AND json.rule = replicationInstanceStatus is not member of ('creating','deleted','deleting') and publiclyAccessible is true"
,888f2731-6748-44a6-bcbc-3718205a7b0e,iam,aws,high,AWS Administrators with IAM permissions are unused for 90 days,"This policy identifies AWS IAM Users with Stale IAM Permissions (Unused for 90 days).  Risk of Unused IAM Permissions: IAM users with any level of permissions (administrative or otherwise) that haven't been used for 90 days pose a security risk because: Unsecured Access Point: These accounts act like forgotten open doors. If compromised, attackers can exploit them to gain access to AWS resources and perform unauthorized actions, potentially leading to data breaches or financial losses. Elevated Attack Potential: IAM user permissions can vary widely, with some granting high-level access to modify configurations, create new resources, or manage IAM policies. If compromised, an unused account with such permissions could be devastating.  Mitigating the Risk: Regular Review and Removal: Proactively identify and remove unused IAM users on a regular basis (ideally less than 90 days). Focus on users with any level of permissions, not just administrative privileges. Principle of Least Privilege: When creating IAM users, assign only the minimum permissions required for them to perform their specific tasks. Regularly review and adjust permissions as needed. Multi-Factor Authentication (MFA): Enforce MFA for all IAM users to add an extra layer of security and make it significantly harder for attackers to compromise an account, even if they obtain the credentials. IAM User Access Review: Utilize the AWS IAM Access Review feature to automate the process of identifying and flagging unused accounts for review and potential removal. Monitor for Suspicious Activity: Utilize CloudTrail to track API calls made within your AWS environment, including those leveraging IAM users. This vigilance can help detect unusual activity related to unused accounts that might indicate a compromise.",config from iam where source.cloud.type = 'AWS' and action.access.isadministrative = true and action.lastaccess.days > 90
,cf87131d-0fa0-4f58-b4f1-6a401d89ee9f,iam,aws,high,AWS Compute Instance (EC2/Lambda) Assigned Permissions to Run EC2 Instances Which Could Lead to Privilege Escalation,"An adversary able to run EC2 instances with any role would be able to escalate their permissions by attaching a privileged role to the instance. As such, they would obtain the permissions of the role attached to the EC2, allowing further enumeration and exploitation of the environment.","config from iam where dest.cloud.type = 'AWS' AND action.name CONTAINS ALL ('iam:PassRole', 'ec2:RunInstances') AND source.cloud.resource.type IN ('instance', 'function')"
PC-AWS-KMS-20,497f7e2c-b702-47c7-9a07-f0f6404ac896,config,aws,informational,AWS Customer Master Key (CMK) rotation is not enabled,"This policy identifies Customer Master Keys (CMKs) that are not enabled with key rotation. AWS KMS (Key Management Service) allows customers to create master keys to encrypt sensitive data in different services. As a security best practice, it is important to rotate the keys periodically so that if the keys are compromised, the data in the underlying service is still secure with the new keys.","config from cloud.resource where cloud.type = 'aws' AND api.name='aws-kms-get-key-rotation-status' AND json.rule = keyMetadata.keyState equals Enabled and keyMetadata.keyManager equals CUSTOMER and keyMetadata.origin equals AWS_KMS and (rotation_status.keyRotationEnabled is false or rotation_status.keyRotationEnabled equals ""null"") and keyMetadata.customerMasterKeySpec equals SYMMETRIC_DEFAULT"
,0acd23f7-12c8-48c2-88c4-2962a4778e6e,iam,aws,high,AWS EC2 Instance with AWS Organization management permissions,"This policy identifies IAM permissions that allow EC2 instances to manage AWS Organizations such as creating, deleting, updating AWS Organizations, accounts and Org level policies, features, and services.  AWS Organization write permissions are very risky and should only be used under very strict controls.  Unnecessary usage of these permissions can significantly increase your attack surface and make it easier for attackers to compromise your AWS environment.","config from iam where dest.cloud.type = 'AWS' AND action.name IN ('organizations:AcceptHandshake','organizations:AttachPolicy','organizations:CancelHandshake','organizations:CreateAccount','organizations:CreateGovCloudAccount','organizations:CreateOrganization','organizations:CreateOrganizationalUnit','organizations:CreatePolicy','organizations:DeclineHandshake','organizations:DeleteOrganization','organizations:DeleteOrganizationalUnit','organizations:DeletePolicy','organizations:DeregisterDelegatedAdministrator','organizations:DetachPolicy','organizations:DisableAWSServiceAccess','organizations:DisablePolicyType','organizations:EnableAWSServiceAccess','organizations:EnableAllFeatures','organizations:EnablePolicyType','organizations:InviteAccountToOrganization','organizations:LeaveOrganization','organizations:MoveAccount','organizations:RegisterDelegatedAdministrator','organizations:RemoveAccountFromOrganization','organizations:UpdateOrganizationalUnit','organizations:UpdatePolicy') AND source.cloud.service.name = 'ec2' AND source.cloud.resource.type = 'instance'"
PC-AWS-S3-1113,48744a10-f434-4930-b9ff-4cf8903f50ff,config,aws,high,AWS CloudTrail S3 bucket encrypted with Customer Managed Key (CMK) that is scheduled for deletion,"This policy identifies AWS CloudTrail S3 buckets encrypted with Customer Managed Key (CMK) that is scheduled for deletion.  CloudTrail logs contain account activity related to actions across your AWS infrastructure. These log files stored in Amazon S3 are encrypted by AWS KMS keys. Deleting keys in AWS KMS that are used by CloudTrail is a common defense evasion technique and could be a potential ransomware attacker activity. After a key is deleted, you can no longer decrypt the data that was encrypted under that key, which helps the attacker to hide their malicious activities.  It is recommended to regularly monitor the key used for encryption to prevent accidental deletion.","config from cloud.resource where cloud.type = 'aws' AND api.name= 'aws-s3api-get-bucket-acl' AND json.rule = (sseAlgorithm contains ""aws:kms"" or sseAlgorithm contains ""aws:kms:dsse"") and kmsMasterKeyID exists as X; config from cloud.resource where api.name = 'aws-kms-get-key-rotation-status' AND json.rule = keyMetadata.keyManager equal ignore case CUSTOMER and keyMetadata.keyState contains PendingDeletion as Y; config from cloud.resource where api.name = 'aws-cloudtrail-describe-trails' as Z; filter '$.X.kmsMasterKeyID contains $.Y.key.keyArn and $.Z.s3BucketName equals $.X.bucketName'; show X;"
PC-AWS-RDS-1177,9090e54c-abec-4aed-95a6-4971a35b98dc,config,aws,informational,AWS Aurora MySQL DB cluster does not publish audit logs to CloudWatch Logs,"This policy identifies AWS Aurora MySQL DB cluster where audit logging is disabled or audit logs are not published to Amazon CloudWatch Logs.  Aurora MySQL DB cluster integrates with Amazon CloudWatch for performance metric gathering and analysis, supporting CloudWatch Alarms. While the Aurora MySQL DB cluster provides customizable audit logs for monitoring database operations, these logs are not automatically sent to CloudWatch Logs, limiting centralized monitoring and analysis of database activities.  It is recommended to configure the Aurora MySQL DB cluster to enable audit logs and publish audit logs to CloudWatch","config from cloud.resource where api.name = 'aws-rds-db-cluster' AND json.rule = engine equals ""aurora-mysql"" and status equals ""available"" as X; config from cloud.resource where api.name = 'aws-rds-db-cluster-parameter-group' AND json.rule = DBParameterGroupFamily contains ""aurora-mysql"" as Y; filter '$.X.dBclusterParameterGroupArn equals $.Y.DBClusterParameterGroupArn and (($.Y.parameters.server_audit_logging.ParameterValue does not exist or $.Y.parameters.server_audit_logging.ParameterValue equals 0) or ($.X.enabledCloudwatchLogsExports does not contain ""audit"" and $.Y.parameters.server_audit_logs_upload.ParameterValue equals 0))' ; show X;"
PC-AWS-ACM-214,4f729fe3-3c9d-4255-81da-ae2f6fe0c34b,config,aws,low,AWS ACM Certificate with wildcard domain name,"This policy identifies ACM Certificates which are using wildcard certificates for wildcard domain name instead of single domain name certificates. ACM allows you to use an asterisk (*) in the domain name to create an ACM Certificate containing a wildcard name that can protect several sites in the same domain. For example, a wildcard certificate issued for *.prismacloud.io can match both www.prismacloud.io and images.prismacloud.io. When you use wildcard certificates, if the private key of a certificate is compromised, then all domain and subdomains that use the compromised certificate are potentially impacted. So it is recommended to use single domain name certificates instead of wildcard certificates to reduce the associated risks with a compromised domain or subdomain.",config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-acm-describe-certificate' AND json.rule = 'domainValidationOptions[*].domainName contains *'
PC-AWS-CT-3,36a5345a-230d-438e-a04c-a287a513e3dc,config,aws,informational,AWS CloudTrail is not enabled with multi trail and not capturing all management events,"This policy identifies the AWS accounts which do not have a CloudTrail with multi trail enabled and capturing all management events. AWS CloudTrail is a service that enables governance, compliance, operational & risk auditing of the AWS account. It is a compliance and security best practice to turn on CloudTrail across different regions to get a complete audit trail of activities across various services.  NOTE: If you have Organization Trail enabled in your account, this policy can be disabled, or alerts generated for this policy on such an account can be ignored; as Organization Trail by default enables trail log for all accounts under that organization.","config from cloud.resource where api.name= 'aws-cloudtrail-describe-trails' AND json.rule = 'isMultiRegionTrail is true and includeGlobalServiceEvents is true' as X; config from cloud.resource where api.name= 'aws-cloudtrail-get-trail-status' AND json.rule = 'status.isLogging equals true' as Y; config from cloud.resource where api.name= 'aws-cloudtrail-get-event-selectors' AND json.rule = '(eventSelectors[*].readWriteType contains All and eventSelectors[*].includeManagementEvents equal ignore case true) or (advancedEventSelectors[*].fieldSelectors[*].equals contains ""Management"" and advancedEventSelectors[*].fieldSelectors[*].field does not contain ""readOnly"" and advancedEventSelectors[*].fieldSelectors[*].field does not contain ""eventSource"")' as Z; filter '($.X.trailARN equals $.Z.trailARN) and ($.X.name equals $.Y.trail)'; show X; count(X) less than 1"
PC-AWS-DOC-882,8a1eca79-23af-45b2-bda4-ba6b2f4fa14a,config,aws,low,AWS DocumentDB Cluster is not enabled with data encryption in transit,"This policy identifies Amazon DocumentDB Clusters for which data encryption in transit is disabled. Each DocumentDB Cluster is associated with a Cluster Parameter Group. It is highly recommended to implement in-transit encryption in order to protect data from unauthorized access as it travels through the network, between clients and the cluster.","config from cloud.resource where api.name = 'aws-docdb-db-cluster-parameter-group' AND json.rule = parameters.tls.ParameterValue equals ""disabled"" as X; config from cloud.resource where api.name = 'aws-docdb-db-cluster' AND json.rule = Status equals available as Y; filter '$.X.DBClusterParameterGroupName equals $.Y.DBClusterParameterGroup'; show Y;"
PC-AWS-DYN-1135,facc5782-011c-4f1c-adea-f38c08962f5c,config,aws,low,AWS DynamoDB table point-in-time recovery (PITR) disabled,This policy identifies AWS DynamoDB tables that does not have point-in-time recovery (backup) enabled.  AWS DynamoDB enables you to back up your table data continuously by using point-in-time recovery (PITR) with per-second granularity. This helps in protecting your data against accidental write or delete operations.  It is recommended to enable point-in-time recovery functionality on the DynamoDB table to protect data.,config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-dynamodb-describe-table' AND json.rule = tableStatus equal ignore case ACTIVE AND continuousBackupsDescription.pointInTimeRecoveryDescription.pointInTimeRecoveryStatus does not equal ENABLED
PC-AWS-ASY-1180,a0862fa8-256a-458f-9a63-192add13a53f,config,aws,informational,AWS AppSync GraphQL API is authenticated with API key,"This policy identifies the AWS AppSync Graphql API using API key for primary or additional authentication methods.  AWS AppSync GraphQL API is a fully managed service by Amazon Web Services for building scalable and secure GraphQL APIs. An API key is a hard-coded value in your application generated by the AWS AppSync service when you create an unauthenticated GraphQL endpoint. Using API keys for authentication can pose security risks such as exposure to unauthorized access and limited control over access privileges, potentially compromising sensitive data and system integrity.  It is recommended to use authentication methods other than API Keys like IAM, Amazon Cognito User Pools, or OpenID Connect providers for securing AWS AppSync GraphQL APIs, to ensure enhanced security and access control.","config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-appsync-graphql-api' AND json.rule = authenticationType equals ""API_KEY"" or additionalAuthenticationProviders[?any( authenticationType equals ""API_KEY"" )] exists"
,f13c6791-8e1d-4985-9473-8463c2ab3e95,iam,aws,high,AWS Compute Instance (EC2/Lambda) Assigned Glue DevEndpoint Creation Permissions Which Could Lead to Privilege Escalation,"An adversary able to create a Glue DevEndpoint with any role would be able to escalate their permissions by attaching a privileged role to the endpoint and configuring authentication to the endpoint using a key which they control. As such, they would obtain the ability to perform actions using the permissions of the attached role, allowing further enumeration and exploitation of the environment.","config from iam where dest.cloud.type = 'AWS' AND action.name CONTAINS ALL ('iam:PassRole', 'glue:CreateDevEndpoint') AND source.cloud.resource.type IN ('instance', 'function')"
PC-AWS-API-542,3bc575db-9c1c-4ae3-aeb1-107989ef6fca,config,aws,low,AWS API gateway request authorisation is not set,This policy identifies AWS API Gateways of protocol type REST for which the request authorisation is not set. The method request for API gateways takes the client input that is passed to the back end through the integration request. It is recommended to add authorization type to each of the method to add a layer of protection.,config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-apigateway-method' AND json.rule = authorizationType contains NONE
PC-AWS-COG-1140,3626a6d9-d55e-48b2-ae4c-2453ab65ff88,config,aws,medium,AWS Cognito identity pool allows unauthenticated guest access,This policy identifies AWS Cognito identity pools that allow unauthenticated guest access.  AWS Cognito identity pools unauthenticated guest access and allows unauthenticated users to assume a role in your AWS account. These unauthenticated users will be granted permissions of the assumed role which may have more privileges than that are intended. This could lead to unauthorized access or data leakage.  It is recommended to disable unauthenticated guest access for the Cognito identity pools.,config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-cognito-identity-pool' AND json.rule = allowUnauthenticatedIdentities is true
PC-AWS-DYN-1150,93b2372d-222d-476d-a47d-6c4f9d2a4f67,config,aws,informational,AWS DynamoDB table deletion protection is disabled,"This policy identifies AWS DynamoDB tables with deletion protection disabled.  DynamoDB is a fully managed NoSQL database that provides a highly reliable, scalable, low-latency database solution for applications that require consistent, single-digit millisecond latency at any scale. Deletion protection feature allows authorised administrators to prevent accidental deletion of DynamoDB tables. Enabling deletion protection helps reduce the risk of data loss, maintain data integrity, ensure compliance, and protect DynamoDB tables across different environments.  It is recommended to enable deletion protection on DynamoDB tables to prevent unintended data loss.",config from cloud.resource where api.name = 'aws-dynamodb-describe-table' AND json.rule = tableStatus equal ignore case ACTIVE and deletionProtectionEnabled is false
PC-AWS-CFR-350,a920a1a2-6856-4eb2-b2db-7aee4ce03f4c,config,aws,low,AWS CloudFront web distribution with geo restriction disabled,This policy identifies CloudFront web distributions which have geo restriction feature disabled. Geo Restriction has the ability to block IP addresses based on Geo IP by allowlist or denylist a country in order to allow or restrict users in specific locations from accessing web application content.,config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-cloudfront-list-distributions' AND json.rule = 'restrictions.geoRestriction.restrictionType contains none'
PC-AWS-ACM-165,546a493a-3979-42d1-a018-e07dbfc15ae6,config,aws,informational,AWS Certificate Manager (ACM) has certificates with Certificate Transparency Logging disabled,"This policy identifies AWS Certificate Manager certificates in which Certificate Transparency Logging is disabled. AWS Certificate Manager (ACM) is the preferred tool to provision, manage, and deploy your server certificates. Certificate Transparency Logging is used to guard against SSL/TLS certificates that are issued by mistake or by a compromised CA, some browsers require that public certificates issued for your domain can also be recorded. This policy generates alerts for certificates which have transparency logging disabled. As a best practice, it is recommended to enable Transparency logging for all certificates.",config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-acm-describe-certificate' AND json.rule = 'type does not equal IMPORTED and (options.certificateTransparencyLoggingPreference equals DISABLED or options.certificateTransparencyLoggingPreference does not exist) and status equals ISSUED and _DateTime.ageInDays($.notAfter) < 1'
PC-AWS-ASG-1138,d4cb69d1-c09d-4b7e-beb0-8c43adad117d,config,aws,informational,AWS EC2 Auto Scaling Launch Configuration is not using encrypted EBS volumes,"This policy identifies AWS EC2 Auto Scaling Launch Configurations that are not using encrypted EBS volumes.  A launch configuration defines an instance configuration template that an Auto Scaling group uses to launch EC2 instances. Amazon Elastic Block Store (EBS) volumes allow you to create encrypted launch configurations when creating EC2 instances and auto scaling groups. When the entire EBS volume is encrypted, data stored at rest, in-transit, and snapshots are encrypted. This protects the data from unauthorized access.  As a security best practice for data protection, enable encryption for all EBS volumes at auto scaling launch configuration.",config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-ec2-autoscaling-launch-configuration' AND json.rule = blockDeviceMappings[*].ebs exists AND blockDeviceMappings[?any(ebs.encrypted is false)] exists
PC-AWS-CF-353,40351182-3b54-4f35-9e1e-423bbc5476ff,config,aws,low,AWS CloudFormation template contains globally open resources,"This alert triggers if a CloudFormation template that when launched will result in resources allowing global network access. Below are three common causes:  - Security Group with a {0.0.0.0/0, ::/0} rule - Network Access Control List with a {0.0.0.0/0, ::/0} rule - Network Access Control List with -1 IpProtocol","config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-cloudformation-describe-stacks' AND json.rule = ""(($.stackResources[?( @.resourceType == 'AWS::EC2::SecurityGroup' || @.resourceType == 'AWS::EC2::SecurityGroupIngress' || @.resourceType == 'AWS::EC2::NetworkAclEntry')].resourceStatus any equal CREATE_COMPLETE) or ($.stackResources[?( @.resourceType == 'AWS::EC2::SecurityGroup' || @.resourceType == 'AWS::EC2::SecurityGroupIngress' || @.resourceType == 'AWS::EC2::NetworkAclEntry')].resourceStatus any equal UPDATE_COMPLETE)) and (($.cloudFormationTemplate.Resources.{}.SecurityGroupIngress[*].CidrIp any equal 0.0.0.0/0 or $.cloudFormationTemplate.Resources.{}.SecurityGroupIngress[*].CidrIpv6 any equal ::/0 or $.cloudFormationTemplate.Resources.{}.Properties.CidrIp any equal 0.0.0.0/0 or $.cloudFormationTemplate.Resources.{}.Properties.CidrIpv6 any equal ::/0) or ($.cloudFormationTemplate.Resources.{}.Properties.CidrBlock any equal 0.0.0.0/0 or $.cloudFormationTemplate.Resources.{}.Properties.Ipv6CidrBlock any equal ::/0 or $.cloudFormationTemplate.Resources.{}.Properties.Protocol any equal -1))"""
PC-AWS-ELB-907,740c318e-b1b5-4e48-8488-946e3ffcc3f7,config,aws,low,AWS Classic Load Balancer not configured to span multiple Availability Zones,"This policy identifies AWS Classic Load Balancers that are not configured to span multiple Availability Zones. Classic Load Balancer would not be able to redirect traffic to targets in another Availability Zone if the sole configured Availability Zone becomes unavailable. As best practice, it is recommended to configure Classic Load Balancer to span multiple Availability Zones.  ",config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-elb-describe-load-balancers' AND json.rule = description.availabilityZones[*] size less than 2
PC-AWS-S3-1,b76ad441-e715-4fd0-bbc3-cd3b2bee34bf,config,aws,low,AWS CloudTrail bucket is publicly accessible,This policy identifies publicly accessible S3 buckets that store CloudTrail data. These buckets contains sensitive audit data and only authorized users and applications should have access.,"config from cloud.resource where cloud.type = 'aws' AND api.name='aws-s3api-get-bucket-acl' AND json.rule = ""((((acl.grants[?(@.grantee=='AllUsers')] size > 0) or policyStatus.isPublic is true) and publicAccessBlockConfiguration does not exist and accountLevelPublicAccessBlockConfiguration does not exist) or ((acl.grants[?(@.grantee=='AllUsers')] size > 0) and ((publicAccessBlockConfiguration.ignorePublicAcls is false and accountLevelPublicAccessBlockConfiguration does not exist) or (publicAccessBlockConfiguration does not exist and accountLevelPublicAccessBlockConfiguration.ignorePublicAcls is false) or (publicAccessBlockConfiguration.ignorePublicAcls is false and accountLevelPublicAccessBlockConfiguration.ignorePublicAcls is false))) or (policyStatus.isPublic is true and ((publicAccessBlockConfiguration.restrictPublicBuckets is false and accountLevelPublicAccessBlockConfiguration does not exist) or (publicAccessBlockConfiguration does not exist and accountLevelPublicAccessBlockConfiguration.restrictPublicBuckets is false) or (publicAccessBlockConfiguration.restrictPublicBuckets is false and accountLevelPublicAccessBlockConfiguration.restrictPublicBuckets is false))))"" as X; config from cloud.resource where api.name = 'aws-cloudtrail-describe-trails' as Y; filter'$.X.bucketName equals $.Y.s3BucketName'; show X;"
,0ac76a55-5858-4bf1-9e3a-506f976346a0,iam,aws,medium,AWS EC2 IAM role with Elastic IP Hijacking permissions,"This precision-crafted IAM policy provides vigilant control over essential actions within AWS, specifically targeting 'instance' resources. By meticulously governing access to actions like 'ec2:DisassociateAddress' and 'ec2:EnableAddressTransfer', this policy serves as a bulwark against unauthorized endeavors to transfer Elastic IPs to unauthorized accounts, bolstering the security of your cloud environment.","config from iam where dest.cloud.type = 'AWS' AND action.name IN ('ec2:DisassociateAddress', 'ec2:EnableAddressTransfer') AND source.cloud.service.name = 'ec2' AND source.cloud.resource.type = 'instance'"
PC-AWS-DOC-1160,64308452-3d8f-4a1c-b566-a49f9a7c221b,config,aws,informational,AWS DocumentDB cluster does not publish audit logs to CloudWatch Logs,"This policy identifies the Amazon DocumentDB cluster where audit logging is disabled or audit logs are not published to Amazon CloudWatch Logs.  DocumentDB integrates with Amazon CloudWatch for performance metric gathering and analysis, supporting CloudWatch Alarms. While DocumentDB provides customizable audit logs for monitoring database operations, these logs are not automatically sent to CloudWatch Logs, limiting centralized monitoring and analysis of database activities.  It is recommended to configure the DocumentDB cluster to enable audit logs and publish audit logs to CloudWatch logs.","config from cloud.resource where api.name = 'aws-docdb-db-cluster' AND json.rule = Status equals ""available"" as X; config from cloud.resource where api.name = 'aws-docdb-db-cluster-parameter-group' AND json.rule = parameters.audit_logs.ParameterValue is member of ( 'disabled','none') as Y; filter '($.X.EnabledCloudwatchLogsExports.member does not contain ""audit"") or $.X.DBClusterParameterGroup equals $.Y.DBClusterParameterGroupName' ; show X;"
PC-AWS-DOC-1156,93cb90e8-34c5-4906-bd46-aea61371f54c,config,aws,low,AWS DocumentDB clusters have backup retention period less than 7 days,"This policy identifies Amazon DocumentDB clusters lacking sufficient backup retention tenure.  Amazon DocumentDB clusters are managed database services on AWS, compatible with MongoDB. They handle tasks like provisioning and backup. With features like automated backups and read replicas, they offer a reliable solution for MongoDB workloads in the cloud. The backup retention period denotes the duration for storing automated backups of the DocumentDB cluster. Inadequate retention periods heighten the risk of data loss, compliance issues, and hinder effective recovery in security breaches or system failures.  It is recommended to ensure a backup retention period of at least 7 days or according to your business and compliance requirement.",config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-docdb-db-cluster' AND json.rule = Status equals available and ( BackupRetentionPeriod does not exist or BackupRetentionPeriod less than 7 )
PC-AWS-ELB-1157,79b84113-d47b-412f-9bd0-381cd4a0d50e,config,aws,low,AWS Application Load Balancer (ALB) is not configured to drop HTTP headers,"This policy identifies AWS Application Load Balancers that are not configured to drop HTTP headers.  AWS Application Load Balancers distribute incoming HTTP/HTTPS traffic across multiple targets such as EC2 instances, containers, and Lambda functions, based on routing rules and health checks. By default, ALBs are not configured to drop invalid HTTP header values, which can leave the load balancer vulnerable to HTTP desync attacks. HTTP desync attacks manipulate request headers to exploit inconsistencies between servers, potentially leading to security vulnerabilities and unauthorized access.  It is recommended to enable this feature, to prevent the load balancer from forwarding requests with invalid HTTP headers to mitigate potential security vulnerabilities.",config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-elbv2-describe-load-balancers' AND json.rule = type equals application and ['attributes'].['routing.http.drop_invalid_header_fields.enabled'] is false
PC-AWS-EC2-269,8f2a2ff7-b484-463d-95df-aecd038f62b0,config,aws,informational,AWS EC2 Instance IAM Role not enabled,"AWS provides Identity Access Management (IAM) roles to securely access AWS services and resources. The role is an identity with permission policies that define what the identity can and cannot do in AWS. As a best practice, create IAM roles and attach the role to manage EC2 instance permissions securely instead of distributing or sharing keys or passwords.",config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-ec2-describe-instances' AND json.rule =  iamInstanceProfile.arn does not exist and state.code equals 16
PC-AWS-EC2-711,aee32861-a98a-4937-83cf-9e94bd509575,config,aws,medium,AWS Amazon Machine Image (AMI) infected with mining malware,"This policy identifies Amazon Machine Images (AMIs) that are infected with mining malware. As per research, AWS Community AMI Windows 2008 hosted by an unverified vendor containing malicious code running an unidentified crypto (Monero) miner. It is recommended to delete such AMIs to protect from malicious activity and attack blast.",config from cloud.resource where cloud.type = 'aws' AND api.name='aws-ec2-describe-images' AND json.rule = image.platform contains windows and image.imageId contains ami-1e542176
PC-AWS-IAM-1126,7ae69a11-ae24-4883-aba9-b230ba90a5c8,config,aws,medium,AWS Cognito service role does not have identity pool verification,"This policy identifies the AWS Cognito service role that does not have identity pool verification.  AWS Cognito is an identity and access management service for web and mobile apps. AWS Cognito service roles define permissions for AWS services accessing resources. The 'aud' claim in a cognito service role is an identity pool token that specifies the intended audience for the token. If the aud claim is not enforced in the cognito service role trust policy, it could potentially allow tokens issued for one audience to be used to access resources intended for a different audience. This oversight increases the risk of unauthorized access, compromising access controls and elevating the potential for data breaches within the AWS environment.  It is recommended to implement proper validation of the 'aud' claim by adding the 'aud' in the Cognito service role trust policy.","config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-iam-list-roles' AND json.rule = role.assumeRolePolicyDocument.Statement[*].Action contains ""sts:AssumeRoleWithWebIdentity"" and role.assumeRolePolicyDocument.Statement[*].Principal.Federated contains ""cognito-identity.amazonaws.com"" and role.assumeRolePolicyDocument.Statement[*].Effect contains ""Allow"" and role.assumeRolePolicyDocument.Statement[*].Condition.StringEquals does not contain ""cognito-identity.amazonaws.com:aud"""
PC-AWS-CFR-344,a1152fef-3480-45bf-a7dd-eb4de3ed9943,config,aws,informational,AWS CloudFront web distribution with AWS Web Application Firewall (AWS WAF) service disabled,"This policy identifies Amazon CloudFront web distributions which have the AWS Web Application Firewall (AWS WAF) service disabled. As a best practice, enable the AWS WAF service on CloudFront web distributions to protect against application layer attacks. To block malicious requests to your Cloudfront Content Delivery Network, define the block criteria in the WAF web access control list (web ACL).",config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-cloudfront-list-distributions' AND json.rule = 'webACLId is empty'
PC-AWS-ASG-1055,8336772f-d32c-4a8f-9c72-0ae7dcb637e9,config,aws,medium,AWS Auto Scaling group launch configuration has public IP address assignment enabled,This policy identifies the autoscaling group launch configuration that is configured to assign a public IP address. Auto Scaling groups assign a public IP address to the group's ec2 instances if its associated launch configuration is configured to assign a public IP address. Amazon EC2 instances should only be accessible from behind a load balancer instead of being directly exposed to the internet. It is recommended that the Amazon EC2 instances in an autoscaling group launch configuration do not have an associated public IP address except for limited edge cases.,config from cloud.resource where api.name = 'aws-ec2-autoscaling-launch-configuration' AND json.rule = associatePublicIpAddress exists and associatePublicIpAddress is true
PC-AWS-IAM-1123,487d78f9-875c-44e7-ba4a-d1b945f404b4,config,aws,high,AWS Cognito service role with wide privileges does not validate authentication,"This policy identifies the AWS Cognito service role that has wide privileges and does not validate user authentication.  AWS Cognito is an identity and access management service for web and mobile apps. AWS Cognito service roles define permissions for AWS services accessing resources. The 'amr' field in the service role represents how the user was authenticated. if the user was authenticated using any of the supported providers, the 'amr' will contain 'authenticated' and the name of the provider. Not validating the 'amr' field can allow an unauthenticated user (guest access) with a valid token signed by the identity-pool to assume the Cognito role. If this Cognito role has a '*' wildcard in the action and resource, it could lead to lateral movement or unauthorized access.  Ensuring limiting privileges according to business requirements can help in restricting unauthorized access and misuse of resources. It is recommended to limit the Cognito service role used for guest access to not have a '*' wildcard in the action or resource.","config from cloud.resource where api.name = 'aws-iam-list-roles' AND json.rule = role.assumeRolePolicyDocument.Statement[*].Action contains ""sts:AssumeRoleWithWebIdentity"" and role.assumeRolePolicyDocument.Statement[*].Principal.Federated contains ""cognito-identity.amazonaws.com"" and role.assumeRolePolicyDocument.Statement[*].Effect contains ""Allow"" and role.assumeRolePolicyDocument.Statement[*].Condition contains ""cognito-identity.amazonaws.com:amr"" and role.assumeRolePolicyDocument.Statement[*].Condition contains ""unauthenticated"" as X; config from cloud.resource where api.name = 'aws-iam-get-policy-version' AND json.rule = document.Statement[?any(Effect equals Allow and Action contains :* and Resource equals * )] exists as Y; filter ""($.X.inlinePolicies[*].policyDocument.Statement[?(@.Effect=='Allow' && @.Resource=='*')].Action contains :* ) or ($.X.attachedPolicies[*].policyArn intersects $.Y.policyArn)""; show X;"
PC-AWS-ASY-832,9117b0ea-1f50-43c8-8c52-9e99367f9989,config,aws,low,AWS AppSync not configured with AWS Web Application Firewall v2 (AWS WAFv2),"This policy identifies AWS AppSync which is not configured with AWS Web Application Firewall. As a best practice, enable the AWS WAF service on AppSync to protect against application layer attacks. To block malicious requests to your AppSync, define the block criteria in the WAF web access control list (web ACL).",config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-appsync-graphql-api' AND json.rule = wafWebAclArn does not exist
PC-AWS-VPC-1121,bd7b49dc-3dbe-4ba6-bc46-3b8160a020c5,config,aws,informational,AWS Default VPC is being used,"This policy identifies AWS Default VPCs that are being used.  AWS creates a default VPC automatically upon the creation of your AWS account with a default security group and network access control list (NACL). Using AWS default VPC can lead to limited customization and security concerns due to shared resources and potential misconfigurations, hindering scalability and optimal resource management.  As a best practice, using a custom VPC with specific security and network configuration provides greater flexibility and control over your architecture.",config from cloud.resource where api.name = 'aws-ec2-describe-vpcs' AND json.rule = default is true and shared is false and state equal ignore case available as X; config from cloud.resource where api.name = 'aws-ec2-describe-network-interfaces' AND json.rule = status equal ignore case in-use as Y; filter '$.X.vpcId equals $.Y.vpcId'; show X;
PC-AWS-API-824,24408300-0278-42d5-949b-179fb7bd95d6,config,aws,low,AWS API Gateway REST API not configured with AWS Web Application Firewall v2 (AWS WAFv2),"This policy identifies AWS API Gateway REST API which is not configured with AWS Web Application Firewall. As a best practice, enable the AWS WAF service on API Gateway REST API to protect against application layer attacks. To block malicious requests to your API Gateway REST API, define the block criteria in the WAF web access control list (web ACL).",config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-apigateway-get-stages' AND json.rule = webAclArn does not exist or webAclArn does not start with arn:aws:wafv2
PC-AWS-ELB-631,cc5a49ce-509c-4779-bb00-e1fc6fc6b10c,config,aws,low,AWS Application Load Balancer (ALB) is not using the latest predefined security policy,This policy identifies Application Load Balancers (ALBs) are not using the latest predefined security policy. A security policy is a combination of protocols and ciphers. The protocol establishes a secure connection between a client and a server and ensures that all data passed between the client and your load balancer is private. A cipher is an encryption algorithm that uses encryption keys to create a coded message. So it is recommended to use the latest predefined security policy which uses only secured protocol and ciphers.  We recommend using either non-FIPS security policy ELBSecurityPolicy-TLS13-1-2-2021-06 or FIPS security policy ELBSecurityPolicy-TLS13-1-2-FIPS-2023-04 to meet compliance and security standards that require disabling certain TLS protocol versions or to support legacy clients that require deprecated ciphers.  For more details:  https://docs.aws.amazon.com/elasticloadbalancing/latest/application/create-https-listener.html#describe-ssl-policies,"config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-elbv2-describe-load-balancers' AND json.rule = type equals application and listeners[?any(protocol equals HTTPS and sslPolicy exists and sslPolicy is not member of ('ELBSecurityPolicy-TLS13-1-2-2021-06','ELBSecurityPolicy-TLS13-1-2-FIPS-2023-04'))] exists"
PC-AWS-BLD-1225,225c49ce-9e34-4dc6-a60a-c79b30a4ee15,config,aws,low,AWS CodeBuild project environment variables contain plaintext AWS credentials,"This policy identifies the AWS CodeBuild project that contains the environment variables AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY  and Password in plaintext.  AWS CodeBuild environment variables configure build settings, pass contextual information, and manage sensitive data during the build process. Authentication credentials like AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY should never be stored in clear text, as this could lead to unintended data exposure and unauthorized access.  It is recommended that AWS CodeBuild environment variables be securely managed using AWS Secrets Manager or AWS Systems Manager Parameter Store to store sensitive data and remove plaintext credentials.","config from cloud.resource where api.name = 'aws-code-build-project' AND json.rule = environment.environmentVariables[*].name exists and environment.environmentVariables[?any( (name contains ""AWS_ACCESS_KEY_ID"" or name contains ""AWS_SECRET_ACCESS_KEY"" or name contains ""PASSWORD"" ) and type equals ""PLAINTEXT"")] exists"
PC-AWS-EC2-323,e1d64985-045e-4a48-9a92-da1a16dcd3eb,config,aws,informational,AWS EC2 Instance Scheduled Events,"This policy identifies your Amazon EC2 instances which have a scheduled event. AWS can schedule events for your instances, such as a reboot, stop/start, or retirement. These events do not occur frequently. If one of your instances will be affected by a scheduled event, AWS sends an email to the email address that’s associated with your AWS account prior to the scheduled event, with details about the event, including the start and end date. Depending on the event, you might be able to take action to control the timing of the event. If AWS scheduled event is planned for within 7 days, this signature triggers an alert.","config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-ec2-describe-instances' AND json.rule = 'statusEvents[?any(_DateTime.ageInDays(notBefore) > -7 and (_DateTime.ageInDays(notBefore) < 0 or (description exists and description does not contain ""Completed"")))] exists'"
PC-AWS-EC2-61,861f7435-ffe4-750f-b07f-2a1cb882dbc8,config,aws,low,AWS EBS Snapshot with access for unmonitored cloud accounts,This policy identifies EBS Snapshot with access for unmonitored cloud accounts.The EBS Snapshots which have either the read / write permission opened up for Cloud Accounts which are NOT part of Cloud Accounts monitored by Prisma Cloud. These accounts with read / write privileges should be reviewed and confirmed that these are valid accounts of your organisation (or authorised by your organisation) and are not active under Prisma Cloud monitoring.,config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-ec2-describe-snapshots' AND json.rule = 'snapshot.state equals completed and createVolumePermissions[*].userId size != 0 and _AWSCloudAccount.isRedLockMonitored($.createVolumePermissions[*].userId) is false'
PC-AWS-ACM-1144,97206f64-3af8-4cb9-b189-1d85a205ee07,config,aws,low,AWS Certificate Manager (ACM) RSA certificate key length less than 2048,"This policy identifies the RSA certificates managed by AWS Certificate Manager with a key length of less than 2048 bits.   AWS Certificate Manager (ACM) is a service for managing SSL/TLS certificates. RSA certificates are cryptographic keys used for securing communications over networks. Shorter key lengths may be susceptible to attacks such as brute force or factorization, where an attacker could potentially decrypt the encrypted data by finding the prime factors of the key.  It is recommended that the RSA certificates imported on ACM utilise a minimum key length of 2048 bits or greater to ensure a sufficient level of security.","config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-acm-describe-certificate' AND json.rule = status equals ""ISSUED"" and keyAlgorithm starts with ""RSA-"" and keyAlgorithm equals RSA-1024"
,c6e9f36f-2a31-42bb-bf68-752b2f3c8e7b,iam,aws,high,AWS Compute Instance (EC2/Lambda) Assigned CloudFormation Creation Permissions Which Could Lead to Privilege Escalation,"An adversary able to create CloudFormation stacks with any role would be able to escalate their permissions by attaching a privileged role to the stack while influencing the actions taken by the created resources. As such, they would obtain the ability to perform actions using the permissions of the attached role, allowing further enumeration and exploitation of the environment.","config from iam where dest.cloud.type = 'AWS' AND action.name CONTAINS ALL ('iam:PassRole', 'cloudformation:CreateStack') AND source.cloud.resource.type IN ('instance', 'function')"
PC-AWS-BLD-1057,c2858dc3-d887-436a-80eb-32e2bfd7d0f2,config,aws,medium,AWS CodeBuild project environment privileged mode is enabled,"This policy identifies the CodeBuild projects where the privileged mode is enabled. Privileged mode grants unrestricted access to all devices and runs the Docker daemon inside the container. It is recommended to enable this mode only for building Docker images. It recommended disabling the privileged mode to prevent unintended access to Docker APIs and container hardware, reducing the risk of potential tampering or critical resource deletion.",config from cloud.resource where api.name = 'aws-code-build-project' AND json.rule = environment.privilegedMode exists and environment.privilegedMode is true
PC-AWS-RDS-875,c69f2020-a640-4df1-91fc-f1a14e480cb8,config,aws,medium,AWS Aurora PostgreSQL exposed to local file read vulnerability,"This policy identifies AWS Aurora PostgreSQL which are exposed to local file read vulnerability. AWS Aurora PostgreSQL installed with vulnerable 'log_fdw' extension is exposed to local file read vulnerability, due to which attacker could gain access to local system files of the database instance within their account, including a file which contained credentials specific to Aurora PostgreSQL. It is highly recommended to upgrade AWS Aurora PostgreSQL to the latest version.  For more information, https://aws.amazon.com/security/security-bulletins/AWS-2022-004/","config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-rds-describe-db-instances' AND json.rule = dbinstanceStatus equals available and engine equals aurora-postgresql and engineVersion is member of ('10.11','10.12','10.13','11.6','11.7','11.8')"
PC-AWS-API-158,82493c0b-f4d0-4a82-a5b5-a85df8e78e19,config,aws,low,AWS API Gateway endpoints without client certificate authentication,"API Gateway can generate an SSL certificate and use its public key in the backend to verify that HTTP requests to your backend system are from API Gateway. This allows your HTTP backend to control and accept only requests originating from Amazon API Gateway, even if the backend is publicly accessible.  Note: Some backend servers may not support SSL client authentication as API Gateway does and could return an SSL certificate error. For a list of incompatible backend servers, see Known Issues. https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-known-issues.html",config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-apigateway-get-stages' AND json.rule = 'clientCertificateId does not exist or clientCertificateId equals None'
PC-AWS-CFG-40,4c64a4d6-1b96-4004-8a11-f215aa8ee3ce,config,aws,informational,AWS Config must record all possible resources,"This policy identifies resources for which AWS Config recording is enabled but recording for all possible resources are disabled. AWS Config provides an inventory of your AWS resources and a history of configuration changes to these resources. You can use AWS Config to define rules that evaluate these configurations for compliance. Hence, it is important to enable this feature.",config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-configservice-describe-configuration-recorders' AND json.rule = '(status.recording is true and status.lastStatus equals SUCCESS) and (recordingGroup.allSupported is false or recordingGroup.includeGlobalResourceTypes is false)'
PC-AWS-CFR-349,a072bd68-25cd-4245-94e1-fffee0590a50,config,aws,low,AWS CloudFront web distribution with default SSL certificate,This policy identifies CloudFront web distributions which have a default SSL certificate to access CloudFront content. It is a best practice to use custom SSL Certificate to access CloudFront content. It gives you full control over the content data. custom SSL certificates also allow your users to access your content by using an alternate domain name. You can use a certificate stored in AWS Certificate Manager (ACM) or you can use a certificate stored in IAM.,config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-cloudfront-list-distributions' AND json.rule = 'viewerCertificate.certificateSource contains cloudfront'
PC-AWS-ACM-182,77450a1c-97c2-4d75-847d-1f9c48320a9d,config,aws,low,AWS Certificate Manager (ACM) has invalid or failed certificate,"This policy identifies certificates in ACM which are either in Invalid or Failed state. If the ACM certificate is not validated within 72 hours, it becomes Invalid. An ACM certificate fails when, - the certificate is requested for invalid public domains - the certificate is requested for domains which are not allowed - missing contact information - typographical errors In such cases (Invalid or Failed certificate), you will have to request for a new certificate. It is strongly recommended to delete the certificates which are in failed or invalid state.",config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-acm-describe-certificate' AND json.rule = 'status contains VALIDATION_TIMED_OUT or status contains FAILED'
PC-AWS-CT-50,0d07ac51-fbfe-44fe-8edb-3314c9995ee0,config,aws,informational,AWS CloudTrail trail logs is not integrated with CloudWatch Log,This policy identifies AWS CloudTrail which has trail logs that are not integrated with CloudWatch Log. Enabling the CloudTrail trail logs integrated with CloudWatch Logs will enable the real-time as well as historic activity logging. This will further improve monitoring and alarm capability.,config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-cloudtrail-describe-trails' AND json.rule = 'cloudWatchLogsRoleArn equals null or cloudWatchLogsRoleArn does not exist'
PC-AWS-CFR-825,93a44fd2-7a87-4a2f-8f9f-8774a865c243,config,aws,low,AWS CloudFront not configured with AWS Web Application Firewall v2 (AWS WAFv2),"This policy identifies AWS CloudFront which is not configured with AWS Web Application Firewall v2 (AWS WAFv2). As a best practice, configure the AWS WAFv2 service on the CloudFront to protect against application-layer attacks. To block malicious requests to your CloudFront, define the block criteria in the WAFv2 web access control list (web ACL).",config from cloud.resource where api.name = 'aws-waf-classic-global-web-acl-resource' as X; config from cloud.resource where api.name = 'aws-cloudfront-list-distributions' AND json.rule = webACLId is not empty as Y; filter '$.X.webACL.webACLId equals $.Y.webACLId'; show Y;
PC-AWS-CFR-369,b0aac456-7422-47fc-9144-9b150bd18a9d,config,aws,low,AWS Cloudfront Distribution with S3 have Origin Access set to disabled,This policy identifies the AWS CloudFront distributions which are utilizing S3 bucket and have Origin Access Disabled. The origin access identity feature should be enabled for all your AWS CloudFront CDN distributions in order to restrict any direct access to your objects through Amazon S3 URLs.,config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-cloudfront-list-distributions' AND json.rule = 'origins.items[*].s3OriginConfig exists and origins.items[*].s3OriginConfig.originAccessIdentity is empty and origins.items[*].originAccessControlId is empty'
PC-AWS-S3-306,ed8d6416-1064-4e78-9e34-02336894df44,config,aws,informational,AWS CloudTrail S3 buckets have not enabled MFA Delete,"This policy identifies the S3 buckets which do not have Multi-Factor Authentication enabled for CloudTrails. For encryption of log files, CloudTrail defaults to use of S3 server-side encryption (SSE). We recommend adding an additional layer of security by adding MFA Delete to your S3 bucket. This will help to prevent deletion of CloudTrail logs without your explicit authorization. We also encourage you to use a bucket policy that places restrictions on which of your identity access management (IAM) users are allowed to delete S3 objects.",config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-s3api-get-bucket-acl' as X; config from cloud.resource where api.name = 'aws-cloudtrail-describe-trails' as Y; filter '($.Y.s3BucketName==$.X.bucketName) and ($.X.versioningConfiguration.mfaDeleteEnabled does not exist)'; show X;
PC-AWS-DMS-1226,cb5f94a1-1af7-4867-bfc2-7bf6b64941f5,config,aws,informational,AWS DMS replication task for the target database have logging not set to the minimum severity level,"This policy identifies the DMS replication tasks that are logging isn't enabled or the minimum severity level is less than LOGGER_SEVERITY_DEFAULT for TARGET_APPLY and TARGET_LOAD.  Amazon DMS Logging is crucial in DMS replication for monitoring, troubleshooting, auditing, performance analysis, error detection, recovery, and historical reporting. TARGET_APPLY and TARGET_LOAD must be logged because they manage to apply data and DDL changes, as well as loading data into the target database, crucial for maintaining data integrity during migration. The absence of logging for TARGET_APPLY and TARGET_LOAD components hampers monitoring, compliance, auditing, troubleshooting, and accountability efforts during migration.  It's recommended to enable logging for AWS DMS replication tasks and set a minimal logging level of DEFAULT for TARGET_APPLY and TARGET_LOAD to ensure that informational messages, warnings, and error messages are written to the logs.","config from cloud.resource where api.name = 'aws-dms-replication-task' AND json.rule = ReplicationTaskSettings.Logging.EnableLogging is false or  ReplicationTaskSettings.Logging.LogComponents[?any( Id is member of (""TARGET_APPLY"",""TARGET_LOAD"") and Severity is not member of (""LOGGER_SEVERITY_DEFAULT"",""LOGGER_SEVERITY_DEBUG"",""LOGGER_SEVERITY_DETAILED_DEBUG"") )] exists"
PC-AWS-EC2-778,6960be11-e3a6-46cc-bf66-933c57c2af5d,config,aws,low,AWS EBS volume region with encryption is disabled,This policy identifies AWS regions in which new EBS volumes are getting created without any encryption. Encrypting data at rest reduces unintentional exposure of data stored in EBS volumes. It is recommended to configure EBS volume at the regional level so that every new EBS volume created in that region will be enabled with encryption by using a provided encryption key.,config from cloud.resource where api.name = 'aws-ec2-ebs-encryption' AND json.rule = ebsEncryptionByDefault is false as X; config from cloud.resource where api.name = 'aws-region' AND json.rule = optInStatus does not equal not-opted-in as Y; filter '$.X.region equals $.Y.regionName'; show X;
PC-AWS-CFR-257,366ac171-3066-46d3-a32f-df80b0a9fe56,config,aws,medium,AWS CloudFront origin protocol policy does not enforce HTTPS-only,"This policy identifies AWS CloudFront which has an origin protocol policy that does not enforce HTTPS-only. Enforcing HTTPS protocol policy between origin and CloudFront will encrypt all communication and will be more secure. As a security best practice, enforce HTTPS-only traffic between a CloudFront distribution and the origin.","config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-cloudfront-list-distributions' AND json.rule = enabled is true and origins.items[*] contains customOriginConfig and origins.items[?any(customOriginConfig.originProtocolPolicy does not contain https-only and ( domainName contains "".data.mediastore."" or domainName contains "".mediapackage."" or domainName contains "".elb."" ))] exists"
PC-AWS-CFR-958,e4475583-1d6b-4efe-8974-1bab376b3817,config,aws,medium,AWS CloudFront distributions does not have a default root object configured,"This policy identifies list of CloudFront distributions which does not have default root object configured. If a CloudFront distribution does not have a default root object configured, requests for the root of your distribution pass to your origin server which might return a list of the private contents of your origin. To avoid exposing the contents of your distribution or returning an error it is recommended to specify a default root object.",config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-cloudfront-list-distributions' AND json.rule = defaultRootObject is empty
PC-AWS-VPC-1163,6c9ffb43-fa72-4e85-9b22-86e4ed272a5f,config,aws,low,AWS EC2 Client VPN endpoints client connection logging disabled,This policy identifies AWS EC2 client VPN endpoints with client connection logging disabled.  AWS Client VPN endpoints enable remote clients to securely connect to resources in the Virtual Private Cloud (VPC). Connection logs enable you to track user behaviour on the VPN endpoint and gain visibility.  It is recommended to enable connection logging for AWS EC2 client VPN endpoints.,config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-ec2-client-vpn-endpoint' AND json.rule = status.code equal ignore case available and connectionLogOptions.Enabled is false
PC-AWS-CFR-256,39df6f76-fc34-4660-97a1-fc967e3abe33,config,aws,medium,AWS CloudFront distribution is using insecure SSL protocols for HTTPS communication,"CloudFront, a content delivery network (CDN) offered by AWS, is not using a secure cipher for distribution. It is a best security practice to enforce the use of secure ciphers TLSv1.0, TLSv1.1, and/or TLSv1.2 in a CloudFront Distribution's certificate configuration. This policy scans for any deviations from this practice and returns the results.","config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-cloudfront-list-distributions' AND json.rule = (origins.items[*] contains ""customOriginConfig"") and (origins.items[?(@.customOriginConfig.originSslProtocols.items)] contains ""SSLv3"")"
PC-AWS-ELB-834,974cbc1a-d26b-4465-bbdc-991edf2a334b,config,aws,medium,AWS ALB attached WAFv2 WebACL is not configured with AMR for Log4j Vulnerability,"This policy identifies AWS Application Load Balancer (ALB) attached with WAFv2 WebACL which is not configured with AWS Managed Rules (AMR) for Log4j Vulnerability. As per the guidelines given by AWS, Application Load Balancer (ALB) attached with WAFv2 WebACL should be configured with AWS Managed Rules (AMR) AWSManagedRulesKnownBadInputsRuleSet and AWSManagedRulesAnonymousIpList to protect from Log4j Vulnerability (CVE-2021-44228).  For more information please refer below URL, https://aws.amazon.com/security/security-bulletins/AWS-2021-006/",config from cloud.resource where api.name = 'aws-elbv2-describe-load-balancers' AND json.rule = scheme equals internet-facing and type equals application as X; config from cloud.resource where api.name = 'aws-waf-v2-web-acl-resource' AND json.rule = (webACL.postProcessFirewallManagerRuleGroups.firewallManagerStatement.name does not contain AWSManagedRulesAnonymousIpList or webACL.postProcessFirewallManagerRuleGroups.firewallManagerStatement.name does not contain AWSManagedRulesKnownBadInputsRuleSet) and NOT ( webACL.rules[*].statement.managedRuleGroupStatement.name contains AWSManagedRulesAnonymousIpList and webACL.rules[*].statement.managedRuleGroupStatement.name contains AWSManagedRulesKnownBadInputsRuleSet ) as Y; filter '$.Y.resources.applicationLoadBalancer[*] contains $.X.loadBalancerArn'; show X;
PC-AWS-DMS-1227,e54f1f3f-4c32-4c6f-974e-71dfd1f0496c,config,aws,informational,AWS DMS replication task for the source database have logging not set to the minimum severity level,"This policy identifies AWS DMS replication task where logging is either not enabled or set below the minimum severity level, such as LOGGER_SEVERITY_DEFAULT, for SOURCE_CAPTURE and SOURCE_UNLOAD.  Logging is indispensable in DMS replication for various purposes, including monitoring, troubleshooting, auditing, performance analysis, error detection, recovery, and historical reporting. SOURCE_CAPTURE captures ongoing replication or CDC data from the source database, while SOURCE_UNLOAD unloads data during full load. Logging these tasks is crucial for ensuring data integrity, compliance, and accountability during migration.  It is recommended to enable logging for AWS DMS replication tasks and set a minimal logging level of DEFAULT for SOURCE_CAPTURE and SOURCE_UNLOAD to ensure that essential messages are logged, facilitating effective monitoring, troubleshooting, and compliance efforts.","config from cloud.resource where api.name = 'aws-dms-replication-task' AND json.rule = ReplicationTaskSettings.Logging.EnableLogging is false or  ReplicationTaskSettings.Logging.LogComponents[?any( Id is member of (""SOURCE_CAPTURE"",""SOURCE_UNLOAD"") and Severity is not member of (""LOGGER_SEVERITY_DEFAULT"",""LOGGER_SEVERITY_DEBUG"",""LOGGER_SEVERITY_DETAILED_DEBUG"") )] exists"
PC-AWS-CT-526,626b8868-1da0-4293-a75b-e599ee73c955,config,aws,informational,AWS CloudTrail logging is disabled,"This policy identifies the CloudTrails in which logging is disabled. AWS CloudTrail is a service that enables governance, compliance, operational & risk auditing of the AWS account. It is a compliance and security best practice to turn on logging for CloudTrail across different regions to get a complete audit trail of activities across various services.  NOTE: This policy will be triggered only when you have CloudTrail configured in your AWS account and logging is disabled.",config from cloud.resource where api.name = 'aws-cloudtrail-describe-trails' as X; config from cloud.resource where api.name = 'aws-cloudtrail-get-trail-status' as Y; filter '$.X.name equals $.Y.trail and $.Y.status.isLogging is false'; show X;
PC-AWS-CFR-255,d183c5cd-6fe6-43a9-8fbf-6b4e44c84ec9,config,aws,medium,AWS CloudFront viewer protocol policy is not configured with HTTPS,"For web distributions, you can configure CloudFront to require that viewers use HTTPS to request your objects, so connections are encrypted when CloudFront communicates with viewers.","config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-cloudfront-list-distributions' AND json.rule = defaultCacheBehavior.viewerProtocolPolicy contains ""allow-all"" or cacheBehaviors.items[?any( viewerProtocolPolicy contains ""allow-all"" )] exists"
PC-AWS-ASG-1047,d5b23289-aedc-4dc7-ad24-211ac900eae5,config,aws,medium,AWS Auto Scaling group launch configuration not configured with Instance Metadata Service v2 (IMDSv2),"This policy identifies the autoscaling group launch configuration where IMDSv2 is set to optional. A launch configuration is an instance configuration template that an Auto Scaling group uses to launch EC2 instances. With IMDSv2, every request is now protected by session authentication. Version 2 of the IMDS adds new protections that weren't available in IMDSv1 to further safeguard your EC2 instances created by the autoscaling group. It is recommended to use only IMDSv2 for all your EC2 instances.","config from cloud.resource where api.name = 'aws-ec2-autoscaling-launch-configuration' AND json.rule = (metadataOptions.httpEndpoint does not exist) or (metadataOptions.httpEndpoint equals ""enabled"" and metadataOptions.httpTokens equals ""optional"") as X; config from cloud.resource where api.name = 'aws-describe-auto-scaling-groups' as Y; filter ' $.X.launchConfigurationName equal ignore case $.Y.launchConfigurationName'; show X;"
PC-AWS-WAF-700,7759063b-44f6-41ab-92fa-950f85f4a357,config,aws,low,AWS Application Load Balancer (ALB) not configured with AWS Web Application Firewall v2 (AWS WAFv2),"This policy identifies AWS Application Load Balancers (ALBs) that are not configured with AWS Web Application Firewall v2 (AWS WAFv2). As a best practice, configure the AWS WAFv2 service on the application load balancers to protect against application-layer attacks. To block malicious requests to your application load balancers, define the block criteria in the WAFv2 web access control list (web ACL).",config from cloud.resource where api.name = 'aws-waf-v2-web-acl-resource' AND json.rule = resources.applicationLoadBalancer[*] exists as X; config from cloud.resource where api.name = 'aws-elbv2-describe-load-balancers' AND json.rule = scheme equals internet-facing and type equals application as Y; filter 'not($.X.resources.applicationLoadBalancer[*] contains $.Y.loadBalancerArn)'; show Y;
,9375a27a-aee8-4710-8fff-672193b2e3b9,iam,aws,high,AWS Compute Instance (EC2/Lambda) Assigned IAM Policy Management Permissions Which Could Lead to Privilege Escalation,"An adversary able to influence or change IAM policies could grant themselves extensive permissions using the policies. As such, they would obtain the ability to perform actions allowed by the policies, allowing further enumeration and exploitation of the environment.","config from iam where dest.cloud.type = 'AWS' AND action.name in ('iam:PutGroupPolicy', 'iam:PutRolePolicy', 'iam:AttachGroupPolicy', 'iam:AttachUserPolicy', 'iam:CreatePolicyVersion') AND source.cloud.resource.type IN ('instance', 'function')"
PC-AWS-ELB-648,72859f28-0817-43d2-b249-1a9350e5aa89,config,aws,informational,AWS Classic Load Balancer is in use for internet-facing applications,This policy identifies Classic Load Balancers that are being used for internet-facing HTTP/HTTPS applications. Classic Load Balancer should be used when you have an existing application running in the EC2-Classic network. Application Load Balancers (ALB) is recommended for internet-facing HTTP/HTTPS web applications.  For more details: https://docs.aws.amazon.com/elasticloadbalancing/latest/application/create-application-load-balancer.html,config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-elb-describe-load-balancers' AND json.rule = description.scheme contains internet-facing
PC-AWS-CFR-346,45e37556-3d26-4cdb-8780-5b7fc5f60e01,config,aws,low,AWS CloudFront web distribution using insecure TLS version,"This policy identifies AWS CloudFront web distributions which are configured with TLS versions for HTTPS communication between viewers and CloudFront. As a best practice, use recommended TLSv1.2_2021 as the minimum protocol version in your CloudFront distribution security policies.",config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-cloudfront-list-distributions' AND json.rule = viewerCertificate.certificateSource does not contain cloudfront and viewerCertificate.minimumProtocolVersion does not equal TLSv1.2_2021
PC-AWS-CFR-827,95f10340-d649-46d2-a8c0-362a45dae8da,config,aws,medium,AWS CloudFront attached WAFv2 WebACL is not configured with AMR for Log4j Vulnerability,"This policy identifies AWS CloudFront attached with WAFv2 WebACL which is not configured with AWS Managed Rules (AMR) for Log4j Vulnerability. As per the guidelines given by AWS, CloudFront attached with WAFv2 WebACL should be configured with AWS Managed Rules (AMR) AWSManagedRulesKnownBadInputsRuleSet and AWSManagedRulesAnonymousIpList to protect from Log4j Vulnerability (CVE-2021-44228).  For more information please refer below URL, https://aws.amazon.com/security/security-bulletins/AWS-2021-006/",config from cloud.resource where api.name = 'aws-cloudfront-list-distributions' AND json.rule = webACLId is not empty as X; config from cloud.resource where api.name = 'aws-waf-v2-global-web-acl-resource' AND json.rule =(webACL.postProcessFirewallManagerRuleGroups.firewallManagerStatement.name does not contain AWSManagedRulesAnonymousIpList or webACL.postProcessFirewallManagerRuleGroups.firewallManagerStatement.name does not contain AWSManagedRulesKnownBadInputsRuleSet) and NOT ( webACL.rules[*].statement.managedRuleGroupStatement.name contains AWSManagedRulesAnonymousIpList and webACL.rules[*].statement.managedRuleGroupStatement.name contains AWSManagedRulesKnownBadInputsRuleSet ) as Y; filter '$.Y.webACL.arn equals $.X.webACLId'; show X;
PC-AWS-CT-4,38e3d3cf-b694-46ec-8bd2-8f02194b5040,config,aws,low,AWS CloudTrail log validation is not enabled in all regions,This policy identifies AWS CloudTrails in which log validation is not enabled in all regions. CloudTrail log file validation creates a digitally signed digest file containing a hash of each log that CloudTrail writes to S3. These digest files can be used to determine whether a log file was modified after CloudTrail delivered the log. It is recommended that file validation be enabled on all CloudTrails.,config from cloud.resource where cloud.type = 'aws' and api.name='aws-cloudtrail-describe-trails' AND json.rule='logFileValidationEnabled is false'
PC-AWS-ACM-327,369dcce6-f088-445d-95a7-777af0347821,config,aws,low,AWS Certificate Manager (ACM) has certificates expiring in 30 days or less,"This policy identifies ACM certificates expiring in 30 days or less, which are in the AWS Certificate Manager. If SSL/TLS certificates are not renewed prior to their expiration date, they will become invalid and the communication between the client and the AWS resource that implements the certificates is no longer secure. As a best practice, it is recommended to renew certificates before their validity period ends. AWS Certificate Manager automatically renews certificates issued by the service that is used with other AWS resources. However, the ACM service does not renew automatically certificates that are not in use or not associated anymore with other AWS resources. So the renewal process must be done manually before these certificates become invalid.  NOTE: If you wanted to be notified other than before or less than 30 days; you can clone this policy and replace '30' in RQL with your desired days value. For example, 15 days OR 7 days which will alert certificates expiring in 15 days or less OR 7 days or less respectively.",config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-acm-describe-certificate' AND json.rule = 'status equals ISSUED and (_DateTime.ageInDays($.notAfter) > -31)'
PC-AWS-EC2-35,81a2200a-c63e-4860-85a0-b54eaa581135,config,aws,low,AWS Amazon Machine Image (AMI) is publicly accessible,This policy identifies AWS AMIs which are owned by the AWS account and are accessible to the public. Amazon Machine Image (AMI) provides information to launch an instance in the cloud. The AMIs may contain proprietary customer information and should be accessible only to authorized internal users.,config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-ec2-describe-images' AND json.rule = image.public is true and image.shared is false and image.imageOwnerAlias does not exist
PC-AWS-CFR-271,4a719209-0c06-4f42-a33e-9f0107a76fa9,config,aws,informational,AWS CloudFront distribution with access logging disabled,"This policy identifies CloudFront distributions which have access logging disabled. Enabling access log on distributions creates log files that contain detailed information about every user request that CloudFront receives. Access logs are available for web distributions. If you enable logging, you can also specify the Amazon S3 bucket that you want CloudFront to save files in.",config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-cloudfront-list-distributions' AND json.rule = 'logging.enabled is false and logging.bucket is empty'
PC-AWS-DYN-1152,4de147de-8ba0-4aff-a387-30817d9504a3,config,aws,informational,AWS DynamoDB table Auto Scaling not enabled,"This policy identifies AWS DynamoDB tables with auto-scaling disabled.  DynamoDB is a fully managed NoSQL database that provides a highly reliable, scalable, low-latency database solution for applications that require consistent, single-digit millisecond latency at any scale. Auto-scaling functionality allows you to dynamically alter the allocated throughput capacity for your DynamoDB tables based on current traffic patterns. This feature employs the Application Auto Scaling service to automatically boost provisioned read and write capacity to manage unexpected traffic increases and reduce throughput when the workload falls in order to avoid paying for wasted supplied capacity.  It is recommended to enable auto-scaling for the DynamoDB table to ensure efficient resource utilisation, cost optimisation, improved performance, simplified management, and scalability.",config from cloud.resource where Resource.status = Active AND api.name = 'aws-application-autoscaling-scaling-policy' as Y; config from cloud.resource where api.name = 'aws-dynamodb-describe-table' AND json.rule = tableStatus equal ignore case ACTIVE AND billingModeSummary.billingMode does not equal PAY_PER_REQUEST as X; filter 'not($.Y.ResourceName equals $.X.tableName)'; show X;
PC-AWS-API-543,fccd881f-26d1-485d-a742-3602afe72035,config,aws,low,AWS API gateway request parameter is not validated,"This policy identifies the AWS API gateways for which the request parameters are not validated. When the validation fails, API Gateway fails the request, returns a 400 error response to the caller, and publishes the validation results in CloudWatch Logs. It is recommended to perform basic validation of an API request before proceeding with the integration request to block unvalidated calls to the backend.",config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-apigateway-method' AND json.rule = requestValidatorId does not exist 
PC-AWS-BLD-1229,8381a9e1-638a-442a-b6ad-423262c608c1,config,aws,informational,AWS CodeBuild project not configured with logging configuration,"This policy identifies AWS CodeBuild project environments without a logging configuration.  AWS CodeBuild is a fully managed service for building, testing, and deploying code. Logging is a crucial security feature that allows for future forensic work in the event of a security incident. Correlating abnormalities in CodeBuild projects with threat detections helps boost confidence in their accuracy.  It is recommended to enable logging configuration on CodeBuild projects for monitoring and troubleshooting purposes.",config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-code-build-project' AND json.rule = not(logsConfig.cloudWatchLogs.status equal ignore case enabled or logsConfig.s3Logs.status equal ignore case enabled)
PC-AWS-CT-80,962e0daa-3c2d-4d79-9a5f-e0bf8fd4bb3b,config,aws,informational,AWS CloudTrail logs should integrate with CloudWatch for all regions,"This policy identifies the Cloudtrails which is not integrated with cloudwatch for all regions. CloudTrail uses Amazon S3 for log file storage and delivery, so log files are stored durably. In addition to capturing CloudTrail logs within a specified S3 bucket for long term analysis, realtime analysis can be performed by configuring CloudTrail to send logs to CloudWatch Logs. For a trail that is enabled in all regions in an account, CloudTrail sends log files from all those regions to a CloudWatch Logs log group. It is recommended that CloudTrail logs be sent to CloudWatch Logs.",config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-cloudtrail-describe-trails' as X; config from cloud.resource where api.name = 'aws-cloudtrail-get-trail-status' as Y; filter '(($.X.name == $.Y.trail) and ($.X.cloudWatchLogsLogGroupArn is not empty and $.X.cloudWatchLogsLogGroupArn exists) and $.X.isMultiRegionTrail is false and ($.Y.status.latestCloudWatchLogsDeliveryTime exists))'; show X;
PC-AWS-CT-34,05befc8b-c78a-45e9-98dc-c7fbaef580e7,config,aws,low,AWS CloudTrail is not enabled on the account,"Checks to ensure that CloudTrail is enabled on the account. AWS CloudTrail is a service that enables governance, compliance, operational & risk auditing of the AWS account. It is a compliance and security best practice to turn on CloudTrail to get a complete audit trail of activities across various services. ",config from cloud.resource where cloud.type = 'aws' and api.name='aws-cloudtrail-describe-trails' as X; count(X) less than 1
PC-AWS-CFG-159,ca5c571e-6930-44af-a47b-ebde3ac20ca5,config,aws,informational,AWS Config Recording is disabled,AWS Config is a web service that performs configuration management of supported AWS resources within your account and delivers log files to you. AWS config uses configuration recorder to detect changes in your resource configurations and capture these changes as configuration items. It continuously monitors and records your AWS resource configurations and allows you to automate the evaluation of recorded configurations against desired configurations. This policy generates alerts when AWS Config recorder is not enabled.,config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-configservice-describe-configuration-recorders' AND json.rule = 'status.recording is true and status.lastStatus equals SUCCESS and recordingGroup.allSupported is true' as X; count(X) less than 1
PC-AWS-ABED-1288,34842045-a8a5-481b-9a36-a956c19555d7,config,aws,informational,AWS Bedrock Custom model encrypted with Customer Managed Key (CMK) is not enabled for regular rotation,"This policy identifies AWS Bedrock Custom model encrypted with Customer Managed Key (CMK) is not enabled for regular rotation.  AWS KMS (Key Management Service) allows customers to create master keys to encrypt the Custom model. Not enabling regular rotation for AWS Bedrock custom model key rotation failure can result in potential compliance violations.  As a security best practice, it is important to rotate the keys periodically so that if the keys are compromised, the data in the underlying service is still secure with the new keys.","config from cloud.resource where api.name = 'aws-bedrock-custom-model' as X; config from cloud.resource where api.name = 'aws-kms-get-key-rotation-status' AND json.rule = keyMetadata.keyState equals Enabled and keyMetadata.keyManager equal ignore case CUSTOMER and keyMetadata.origin equals AWS_KMS and (rotation_status.keyRotationEnabled is false or rotation_status.keyRotationEnabled equals ""null"") as Y; filter '$.X.modelKmsKeyArn equals $.Y.key.keyArn'; show X;"
